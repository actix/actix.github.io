<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="stylesheet" href="https://actix.rs/css/bootstrap-reboot.css">
    <link rel="stylesheet" href="https://actix.rs/css/bootstrap.css">
    <link rel="stylesheet" href="https://actix.rs/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://actix.rs/css/actix.css">
    <link rel="stylesheet" href="https://actix.rs/css/highlight.css">
    <link rel="icon" href="https://actix.rs/favicon.ico" title="actix">

    <title>Handlers</title>
  </head>
  <body>
    <header class="navbar navbar-light navbar-toggleable-md bd-navbar">
      <nav class="actix-main-nav">
        <div class="d-flex justify-content-between hidden-lg-up">
            <a href="https://actix.rs/" class="navbar-brand">
              <img src="https://actix.rs/img/logo-nav.png" class="align-middle" alt="">
            </a>
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#actix-main-nav" aria-label="Toggle navigation" aria-controls="actix-main-nav" aria-expanded="false">
              <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div class="navbar-collapse collapse" id="actix-main-nav">
          <ul class="nav navbar-nav">
            <li class="nav-item hd-lg-down">
              <a class="navbar-brand" href="https://actix.rs/"><img src="https://actix.rs/img/logo-nav.png" class="align-middle" alt=""></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://actix.rs/">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://actix.rs/docs/">Documentation</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://actix.rs/community/">Community</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://actix.rs/code/">Code</a>
            </li>
            <li class="nav-item language-selector">
              <i class="fa fa-fw fa-globe" aria-hidden="false"></i>
              <ul class="subitem">
              
                <li class="submenu-item"><a href="https://actix.rs/">English</a></li>
              
              <li ><a href="https://ruster-xyz.github.io/server/Actix-web/whatisactix.html">中文</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
    </header>



<div class="actix-pageheader">
  <div class="container">
    <h1 class="display-4">Handlers</h1>
    
  </div>
</div>

<div class="container actix-docs">
  <div class="row">
    <div class="col-md-3">

      <button class="btn doctoggle" type="button" data-toggle="collapse" data-target="#collapsing-docnav" aria-expanded="false" aria-controls="collapsing-docnav">
        Toggle navigation
      </button>

      <nav class="leftnav collapse show" id="collapsing-docnav">
        <div class="" id="">
          <h5>Introduction</h5>
          <div>
            <ul class="nav">
              
              <li>
                <a href="https://actix.rs/docs/">Welcome</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/whatis/">What is Actix</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/installation/">Installation</a>
              </li>
              
            </ul>
          </div>

          <h5>Basics</h5>
          <div>
            <ul class="nav">
              
              <li>
                <a href="https://actix.rs/docs/getting-started/">Getting Started</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/application/">Application</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/server/">Server</a>
              </li>
              
              <li class="active">
                <a href="https://actix.rs/docs/handlers/">Handlers</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/extractors/">Extractors</a>
              </li>
              
            </ul>
          </div>

          <h5>Advanced</h5>
          <div>
            <ul class="nav">
              
              <li>
                <a href="https://actix.rs/docs/errors/">Errors</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/url-dispatch/">URL Dispatch</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/request/">Requests</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/response/">Responses</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/testing/">Testing</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/middleware/">Middlewares</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/static-files/">Static Files</a>
              </li>
              
            </ul>
          </div>

          <h5>Protocols</h5>
          <div>
            <ul class="nav">
              
              <li>
                <a href="https://actix.rs/docs/websockets/">Websockets</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/http2/">HTTP/2.0</a>
              </li>
              
            </ul>
          </div>

          <h5>Patterns</h5>
          <div>
            <ul class="nav">
              
              <li>
                <a href="https://actix.rs/docs/autoreload/">Autoreloading</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/databases/">Databases</a>
              </li>
              
              <li>
                <a href="https://actix.rs/docs/sentry/">Sentry</a>
              </li>
              
            </ul>
          </div>

          <h5>API Documentation</h5>
          <div>
            <ul class="nav">
              <li><a href="https://docs.rs/actix" target="view_window">actix <span class="fa fa-external-link"></span></a></li>
              <li><a href="https://actix.rs/api/actix-web/stable/actix_web/" target="view_window">actix-web <span class="fa fa-external-link"></span></a></li>
            </ul>
          </div>
        </div>
      </nav>

    </div>
    <div class="col-md-9">
      <div class="actix-content">
        
  

<h1 id="request-handlers">Request Handlers</h1>

<p>A request handler can be any object that implements
<a href="../../actix-web/actix_web/dev/trait.Handler.html"><em>Handler</em></a> trait.</p>

<p>Request handling happens in two stages. First the handler object is called,
returning any object that implements the
<a href="../../actix-web/actix_web/trait.Responder.html#foreign-impls"><em>Responder</em></a> trait.
Then, <code>respond_to()</code> is called on the returned object, converting itself to a <code>AsyncResult</code> or <code>Error</code>.</p>

<p>By default actix provides <code>Responder</code> implementations for some standard types,
such as <code>&amp;'static str</code>, <code>String</code>, etc.</p>

<blockquote>
<p>For a complete list of implementations, check
<a href="../../actix-web/actix_web/trait.Responder.html#foreign-impls"><em>Responder documentation</em></a>.</p>
</blockquote>

<p>Examples of valid handlers:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="s">&#34;Hello world!&#34;</span><span class="w">
</span><span class="w"></span><span class="p">}</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="s">&#34;Hello world!&#34;</span><span class="p">.</span><span class="n">to_owned</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span></code></pre></div>
<p>You can also change the signature to return <code>impl Responder</code> which works well if more
complex types are involved.</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">Responder</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Bytes</span>::<span class="n">from_static</span><span class="p">(</span><span class="s">&#34;Hello world!&#34;</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-rust,ignore" data-lang="rust,ignore">fn index(req: &amp;HttpRequest) -&gt; Box&lt;Future&lt;Item=HttpResponse, Error=Error&gt;&gt; {
    ...
}</code></pre></div>
<p><em>Handler</em> trait is generic over <em>S</em>, which defines the application state&rsquo;s type.
Application state is accessible from the handler with the <code>HttpRequest::state()</code> method;
however, state is accessible as a read-only reference. If you need mutable access to state,
it must be implemented.</p>

<blockquote>
<p><strong>Note</strong>: Alternatively, the handler can use interior mutably to access its own
state. <strong>Beware</strong>, actix creates multiple copies
of the application state and the handlers, unique for each thread. If you run your
application in several threads, actix will create the same amount as number of threads
of application state objects and handler objects.</p>
</blockquote>

<p>Here is an example of a handler that stores the number of processed requests:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">actix_web</span>::<span class="p">{</span><span class="n">App</span><span class="p">,</span><span class="w"> </span><span class="n">HttpRequest</span><span class="p">,</span><span class="w"> </span><span class="n">HttpResponse</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span>::<span class="n">Handler</span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">MyHandler</span><span class="p">(</span><span class="n">Cell</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Handler</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyHandler</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span><span class="w"> </span><span class="n">HttpResponse</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="sd">/// Handle request
</span><span class="sd"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">handle</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="nb">Result</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="mf">0.</span><span class="n">get</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mf">0.</span><span class="n">set</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="n">HttpResponse</span>::<span class="nb">Ok</span><span class="p">().</span><span class="n">into</span><span class="p">()</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span></code></pre></div>
<p>Although this handler will work, <code>self.0</code> will be different depending on the number of threads and
number of requests processed per thread. A proper implementation would use <code>Arc</code> and <code>AtomicUsize</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">actix_web</span>::<span class="p">{</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">App</span><span class="p">,</span><span class="w"> </span><span class="n">HttpRequest</span><span class="p">,</span><span class="w"> </span><span class="n">HttpResponse</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span>::<span class="n">Handler</span><span class="p">};</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">sync</span>::<span class="n">Arc</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">sync</span>::<span class="n">atomic</span>::<span class="p">{</span><span class="n">AtomicUsize</span><span class="p">,</span><span class="w"> </span><span class="n">Ordering</span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">MyHandler</span><span class="p">(</span><span class="n">Arc</span><span class="o">&lt;</span><span class="n">AtomicUsize</span><span class="o">&gt;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Handler</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyHandler</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span><span class="w"> </span><span class="n">HttpResponse</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="sd">/// Handle request
</span><span class="sd"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">handle</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="nb">Result</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mf">0.</span><span class="n">fetch_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Ordering</span>::<span class="n">Relaxed</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="n">HttpResponse</span>::<span class="nb">Ok</span><span class="p">().</span><span class="n">into</span><span class="p">()</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actix</span>::<span class="n">System</span>::<span class="n">new</span><span class="p">(</span><span class="s">&#34;example&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">inc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arc</span>::<span class="n">new</span><span class="p">(</span><span class="n">AtomicUsize</span>::<span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="n">server</span>::<span class="n">new</span><span class="p">(</span><span class="w">
</span><span class="w">        </span><span class="k">move</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">cloned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inc</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w">
</span><span class="w">            </span><span class="n">App</span>::<span class="n">new</span><span class="p">()</span><span class="w">
</span><span class="w">                </span><span class="p">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">r</span><span class="o">|</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">h</span><span class="p">(</span><span class="n">MyHandler</span><span class="p">(</span><span class="n">cloned</span><span class="p">)))</span><span class="w">
</span><span class="w">        </span><span class="p">})</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#34;127.0.0.1:8088&#34;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">start</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;Started http server: 127.0.0.1:8088&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">run</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span></code></pre></div>
<blockquote>
<p>Be careful with synchronization primitives like <code>Mutex</code> or <code>RwLock</code>. The <code>actix-web</code> framework
handles requests asynchronously. By blocking thread execution, all concurrent
request handling processes would block. If you need to share or update some state
from multiple threads, consider using the <a href="https://actix.github.io/actix/actix/">actix</a> actor system.</p>
</blockquote>

<h2 id="response-with-custom-type">Response with custom type</h2>

<p>To return a custom type directly from a handler function, the type needs to implement the <code>Responder</code> trait.</p>

<p>Let&rsquo;s create a response for a custom type that serializes to an <code>application/json</code> response:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="err">#</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">actix</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="err">#</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">actix_web</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">serde</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">serde_json</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="cp">#[macro_use]</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">serde_derive</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">actix_web</span>::<span class="p">{</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">App</span><span class="p">,</span><span class="w"> </span><span class="n">HttpRequest</span><span class="p">,</span><span class="w"> </span><span class="n">HttpResponse</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">Responder</span><span class="p">,</span><span class="w"> </span><span class="n">http</span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Serialize)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">MyObj</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">name</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="sd">/// Responder
</span><span class="sd"></span><span class="k">impl</span><span class="w"> </span><span class="n">Responder</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyObj</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpResponse</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Error</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">respond_to</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">HttpResponse</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serde_json</span>::<span class="n">to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">        </span><span class="c1">// Create response and set content type
</span><span class="c1"></span><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">HttpResponse</span>::<span class="nb">Ok</span><span class="p">()</span><span class="w">
</span><span class="w">            </span><span class="p">.</span><span class="n">content_type</span><span class="p">(</span><span class="s">&#34;application/json&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">            </span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="n">body</span><span class="p">))</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">Responder</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">MyObj</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span>: <span class="s">&#34;user&#34;</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actix</span>::<span class="n">System</span>::<span class="n">new</span><span class="p">(</span><span class="s">&#34;example&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="n">server</span>::<span class="n">new</span><span class="p">(</span><span class="w">
</span><span class="w">        </span><span class="o">||</span><span class="w"> </span><span class="n">App</span>::<span class="n">new</span><span class="p">()</span><span class="w">
</span><span class="w">            </span><span class="p">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">r</span><span class="o">|</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">method</span><span class="p">(</span><span class="n">http</span>::<span class="n">Method</span>::<span class="n">GET</span><span class="p">).</span><span class="n">f</span><span class="p">(</span><span class="n">index</span><span class="p">)))</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&#34;127.0.0.1:8088&#34;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">start</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;Started http server: 127.0.0.1:8088&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">run</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span></code></pre></div>
<h2 id="async-handlers">Async handlers</h2>

<p>There are two different types of async handlers. Response objects can be generated asynchronously
or more precisely, any type that implements the <a href="../../actix-web/actix_web/trait.Responder.html"><em>Responder</em></a> trait.</p>

<p>In this case, the handler must return a <code>Future</code> object that resolves to the <em>Responder</em> type, i.e:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">actix_web</span>::<span class="o">*</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">bytes</span>::<span class="n">Bytes</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">futures</span>::<span class="n">stream</span>::<span class="n">once</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">futures</span>::<span class="n">future</span>::<span class="p">{</span><span class="n">Future</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Box</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">HttpResponse</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="o">=</span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="n">result</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(</span><span class="n">HttpResponse</span>::<span class="nb">Ok</span><span class="p">()</span><span class="w">
</span><span class="w">              </span><span class="p">.</span><span class="n">content_type</span><span class="p">(</span><span class="s">&#34;text/html&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">              </span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;Hello!&#34;</span><span class="p">))))</span><span class="w">
</span><span class="w">           </span><span class="p">.</span><span class="n">responder</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">index2</span><span class="p">(</span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Box</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="o">=</span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">result</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(</span><span class="s">&#34;Welcome!&#34;</span><span class="p">))</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">responder</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">App</span>::<span class="n">new</span><span class="p">()</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&#34;/async&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">r</span><span class="o">|</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">route</span><span class="p">().</span><span class="n">a</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">r</span><span class="o">|</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">route</span><span class="p">().</span><span class="n">a</span><span class="p">(</span><span class="n">index2</span><span class="p">))</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">finish</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span></code></pre></div>
<p>Or the response body can be generated asynchronously. In this case, body
must implement the stream trait <code>Stream&lt;Item=Bytes, Error=Error&gt;</code>, i.e:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">actix_web</span>::<span class="o">*</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">bytes</span>::<span class="n">Bytes</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">futures</span>::<span class="n">stream</span>::<span class="n">once</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">HttpResponse</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">once</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(</span><span class="n">Bytes</span>::<span class="n">from_static</span><span class="p">(</span><span class="s">b&#34;test&#34;</span><span class="p">)));</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="n">HttpResponse</span>::<span class="nb">Ok</span><span class="p">()</span><span class="w">
</span><span class="w">       </span><span class="p">.</span><span class="n">content_type</span><span class="p">(</span><span class="s">&#34;application/json&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">       </span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="n">Body</span>::<span class="n">Streaming</span><span class="p">(</span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">body</span><span class="p">)))</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">App</span>::<span class="n">new</span><span class="p">()</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&#34;/async&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">r</span><span class="o">|</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">index</span><span class="p">))</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">finish</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span></code></pre></div>
<p>Both methods can be combined. (i.e Async response with streaming body)</p>

<p>It is possible to return a <code>Result</code> where the <code>Result::Item</code> type can be <code>Future</code>.
In this example, the <code>index</code> handler can return an error immediately or return a
future that resolves to a <code>HttpResponse</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">actix_web</span>::<span class="o">*</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">bytes</span>::<span class="n">Bytes</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">futures</span>::<span class="n">stream</span>::<span class="n">once</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">futures</span>::<span class="n">future</span>::<span class="p">{</span><span class="n">Future</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">HttpResponse</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="o">=</span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">is_error</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">       </span><span class="nb">Err</span><span class="p">(</span><span class="n">error</span>::<span class="n">ErrorBadRequest</span><span class="p">(</span><span class="s">&#34;bad request&#34;</span><span class="p">))</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">       </span><span class="nb">Ok</span><span class="p">(</span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="w">
</span><span class="w">           </span><span class="n">result</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(</span><span class="n">HttpResponse</span>::<span class="nb">Ok</span><span class="p">()</span><span class="w">
</span><span class="w">                  </span><span class="p">.</span><span class="n">content_type</span><span class="p">(</span><span class="s">&#34;text/html&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">                  </span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;Hello!&#34;</span><span class="p">))))))</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span></code></pre></div>
<h2 id="different-return-types-either">Different return types (Either)</h2>

<p>Sometimes, you need to return different types of responses. For example,
you can error check and return errors, return async responses, or any result that requires two different types.</p>

<p>For this case, the <a href="../../actix-web/actix_web/enum.Either.html"><em>Either</em></a> type can be used.
<code>Either</code> allows combining two different responder types into a single type.</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">futures</span>::<span class="n">future</span>::<span class="p">{</span><span class="n">Future</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">};</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">actix_web</span>::<span class="p">{</span><span class="n">Either</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">HttpResponse</span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">type</span> <span class="nc">RegisterResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Either</span><span class="o">&lt;</span><span class="n">HttpResponse</span><span class="p">,</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">HttpResponse</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="o">=</span><span class="n">Error</span><span class="o">&gt;&gt;&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="n">req</span>: <span class="kp">&amp;</span><span class="nc">HttpRequest</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="n">Responder</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">is_a_variant</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// &lt;- choose variant A
</span><span class="c1"></span><span class="w">        </span><span class="n">Either</span>::<span class="n">A</span><span class="p">(</span><span class="w">
</span><span class="w">            </span><span class="n">HttpResponse</span>::<span class="n">BadRequest</span><span class="p">().</span><span class="n">body</span><span class="p">(</span><span class="s">&#34;Bad data&#34;</span><span class="p">))</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Either</span>::<span class="n">B</span><span class="p">(</span><span class="w">      </span><span class="c1">// &lt;- variant B
</span><span class="c1"></span><span class="w">            </span><span class="n">result</span><span class="p">(</span><span class="nb">Ok</span><span class="p">(</span><span class="n">HttpResponse</span>::<span class="nb">Ok</span><span class="p">()</span><span class="w">
</span><span class="w">                   </span><span class="p">.</span><span class="n">content_type</span><span class="p">(</span><span class="s">&#34;text/html&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">                   </span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;Hello!&#34;</span><span class="p">)))).</span><span class="n">responder</span><span class="p">())</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span></code></pre></div>

        <div class="github-edit">
            <a class="fa fa-github" href="https://github.com/actix/actix-website/tree/master/content/docs/handlers.md"> Edit on GitHub</a>
        </div>
        
        <div class="actix-next"><b>Next up</b>: <a href = /docs/extractors/>
         Extractors</a></div>
      </div>
    </div>
  </div>
</div>

    <footer class="actix-footer">
      <div class="text-muted actix-footer-gray d-flex justify-content-between">
        <div class="actix-footer-info">
          Copyright © 2018 The Actix Team
        </div>
        <div class="actix-footer-social">
          <a href="https://github.com/actix" class="text-muted"><i class="fa fa-github" aria-hidden="true"></i></a>
        </div>
      </div>
    </footer>

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
    <script src="https://actix.rs/js/bootstrap.min.js"></script>
    <script src="https://actix.rs/js/actix.js"></script>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-110322332-1', 'auto');
ga('send', 'pageview');
</script>

  </body>
</html>
