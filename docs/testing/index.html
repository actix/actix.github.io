<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=https://actix.rs/css/bootstrap-reboot.css><link rel=stylesheet href=https://actix.rs/css/bootstrap.css><link rel=stylesheet href=https://actix.rs/css/font-awesome.min.css><link rel=stylesheet href=https://actix.rs/css/actix.css><link rel=stylesheet href=https://actix.rs/css/highlight.css><link rel=icon href=https://actix.rs/favicon.ico title=actix><title>Testing</title></head><body><header class="navbar navbar-light navbar-toggleable-md bd-navbar"><nav class=actix-main-nav><div class="d-flex justify-content-between hidden-lg-up"><a href=https://actix.rs/ class=navbar-brand><img src=https://actix.rs/img/logo-nav.png class=align-middle alt></a>
<button class="navbar-toggle collapsed" type=button data-toggle=collapse data-target=#actix-main-nav aria-label="Toggle navigation" aria-controls=actix-main-nav aria-expanded=false>
<span class=navbar-toggler-icon></span></button></div><div class="navbar-collapse collapse" id=actix-main-nav><ul class="nav navbar-nav"><li class="nav-item hd-lg-down"><a class=navbar-brand href=https://actix.rs/><img src=https://actix.rs/img/logo-nav.png class=align-middle alt></a></li><li class=nav-item><a class=nav-link href=https://actix.rs/>Home</a></li><li class=nav-item><a class=nav-link href=https://actix.rs/docs/>Documentation</a></li><li class=nav-item><a class=nav-link href=https://actix.rs/community/>Community</a></li><li class=nav-item><a class=nav-link href=https://actix.rs/code/>Code</a></li></ul></div></nav></header><div class=actix-pageheader><div class=container><h1 class=display-4>Testing</h1></div></div><div class="container actix-docs"><div class=row><div class=col-md-3><button class="btn doctoggle" type=button data-toggle=collapse data-target=#collapsing-docnav aria-expanded=false aria-controls=collapsing-docnav>
Toggle navigation</button><nav class="leftnav collapse show" id=collapsing-docnav><div><h5>Introduction</h5><div><ul class=nav><li><a href=https://actix.rs/docs/>Welcome</a></li><li><a href=https://actix.rs/docs/whatis/>What is Actix</a></li><li><a href=https://actix.rs/docs/installation/>Installation</a></li></ul></div><h5>Basics</h5><div><ul class=nav><li><a href=https://actix.rs/docs/getting-started/>Getting Started</a></li><li><a href=https://actix.rs/docs/application/>Application</a></li><li><a href=https://actix.rs/docs/server/>Server</a></li><li><a href=https://actix.rs/docs/handlers/>Handlers</a></li><li><a href=https://actix.rs/docs/extractors/>Extractors</a></li></ul></div><h5>Advanced</h5><div><ul class=nav><li><a href=https://actix.rs/docs/errors/>Errors</a></li><li><a href=https://actix.rs/docs/url-dispatch/>URL Dispatch</a></li><li><a href=https://actix.rs/docs/request/>Requests</a></li><li><a href=https://actix.rs/docs/response/>Responses</a></li><li class=active><a href=https://actix.rs/docs/testing/>Testing</a></li><li><a href=https://actix.rs/docs/middleware/>Middlewares</a></li><li><a href=https://actix.rs/docs/static-files/>Static Files</a></li></ul></div><h5>Protocols</h5><div><ul class=nav><li><a href=https://actix.rs/docs/websockets/>Websockets</a></li><li><a href=https://actix.rs/docs/http2/>HTTP/2.0</a></li></ul></div><h5>Patterns</h5><div><ul class=nav><li><a href=https://actix.rs/docs/autoreload/>Autoreloading</a></li><li><a href=https://actix.rs/docs/databases/>Databases</a></li></ul></div><h5>Diagrams</h5><div><ul class=nav><li><a href=https://actix.rs/docs/http_server_init/>Http Server Initialization</a></li><li><a href=https://actix.rs/docs/conn_lifecycle/>Connection Lifecycle</a></li></ul></div><h5>API Documentation</h5><div><ul class=nav><li><a href=https://docs.rs/actix target=view_window>actix <span class="fa fa-external-link"></span></a></li><li><a href=https://docs.rs/actix-web/ target=view_window>actix-web <span class="fa fa-external-link"></span></a></li></ul></div></div></nav></div><div class=col-md-9><div class=actix-content><h1 id=testing>Testing</h1><p>Every application should be well tested. Actix-web provides tools to perform unit and
integration tests.</p><h1 id=unit-tests>Unit Tests</h1><p>For unit testing, actix-web provides a request builder type.
<a href=https://docs.rs/actix-web/2/actix_web/test/struct.TestRequest.html><em>TestRequest</em></a> implements a builder-like pattern. You can generate a
<code>HttpRequest</code> instance with <code>to_http_request()</code> and call your handler with it.</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=cp>#[cfg(test)]</span><span class=w>
</span><span class=w></span><span class=k>mod</span> <span class=nn>tests</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=k>super</span>::<span class=o>*</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>actix_web</span>::<span class=n>test</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=cp>#[actix_rt::test]</span><span class=w>
</span><span class=w>    </span><span class=n>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>test_index_ok</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>TestRequest</span>::<span class=n>with_header</span><span class=p>(</span><span class=s>&#34;content-type&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;text/plain&#34;</span><span class=p>).</span><span class=n>to_http_request</span><span class=p>();</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>resp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>index</span><span class=p>(</span><span class=n>req</span><span class=p>).</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=n>assert_eq</span><span class=o>!</span><span class=p>(</span><span class=n>resp</span><span class=p>.</span><span class=n>status</span><span class=p>(),</span><span class=w> </span><span class=n>http</span>::<span class=n>StatusCode</span>::<span class=n>OK</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=cp>#[actix_rt::test]</span><span class=w>
</span><span class=w>    </span><span class=n>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>test_index_not_ok</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>TestRequest</span>::<span class=n>default</span><span class=p>().</span><span class=n>to_http_request</span><span class=p>();</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>resp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>index</span><span class=p>(</span><span class=n>req</span><span class=p>).</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=n>assert_eq</span><span class=o>!</span><span class=p>(</span><span class=n>resp</span><span class=p>.</span><span class=n>status</span><span class=p>(),</span><span class=w> </span><span class=n>http</span>::<span class=n>StatusCode</span>::<span class=n>BAD_REQUEST</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><h1 id=integration-tests>Integration tests</h1><p>There are a few methods for testing your application. Actix-web can be used
to run the application with specific handlers in a real http server.</p><p><code>TestRequest::get()</code>, <code>TestRequest::post()</code> and other
methods can be used to send requests to the test server.</p><p>To create a <code>Service</code> for testing, use the <code>test::init_service</code> method which accepts a
regular <code>App</code> builder.</p><blockquote><p>Check the <a href=https://docs.rs/actix-web/2/actix_web/test/index.html>api documentation</a> for more information.</p></blockquote><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=cp>#[cfg(test)]</span><span class=w>
</span><span class=w></span><span class=k>mod</span> <span class=nn>tests</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=k>super</span>::<span class=o>*</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>actix_web</span>::<span class=p>{</span><span class=n>test</span><span class=p>,</span><span class=w> </span><span class=n>web</span><span class=p>,</span><span class=w> </span><span class=n>App</span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=cp>#[actix_rt::test]</span><span class=w>
</span><span class=w>    </span><span class=n>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>test_index_get</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>app</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>init_service</span><span class=p>(</span><span class=n>App</span>::<span class=n>new</span><span class=p>().</span><span class=n>route</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span><span class=w> </span><span class=n>web</span>::<span class=n>get</span><span class=p>().</span><span class=n>to</span><span class=p>(</span><span class=n>index</span><span class=p>))).</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>TestRequest</span>::<span class=n>with_header</span><span class=p>(</span><span class=s>&#34;content-type&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;text/plain&#34;</span><span class=p>).</span><span class=n>to_request</span><span class=p>();</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>resp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>call_service</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>app</span><span class=p>,</span><span class=w> </span><span class=n>req</span><span class=p>).</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=n>assert</span><span class=o>!</span><span class=p>(</span><span class=n>resp</span><span class=p>.</span><span class=n>status</span><span class=p>().</span><span class=n>is_success</span><span class=p>());</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=cp>#[actix_rt::test]</span><span class=w>
</span><span class=w>    </span><span class=n>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>test_index_post</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>app</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>init_service</span><span class=p>(</span><span class=n>App</span>::<span class=n>new</span><span class=p>().</span><span class=n>route</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span><span class=w> </span><span class=n>web</span>::<span class=n>get</span><span class=p>().</span><span class=n>to</span><span class=p>(</span><span class=n>index</span><span class=p>))).</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>TestRequest</span>::<span class=n>post</span><span class=p>().</span><span class=n>uri</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>).</span><span class=n>to_request</span><span class=p>();</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>resp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>call_service</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>app</span><span class=p>,</span><span class=w> </span><span class=n>req</span><span class=p>).</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=n>assert</span><span class=o>!</span><span class=p>(</span><span class=n>resp</span><span class=p>.</span><span class=n>status</span><span class=p>().</span><span class=n>is_client_error</span><span class=p>());</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>If you need more complex application configuration, testing should be very similar to creating
the normal application. For example, you may need to initialize application state. Create an
<code>App</code> with a <code>data</code> method and attach state just like you would from a normal application.</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=cp>#[cfg(test)]</span><span class=w>
</span><span class=w></span><span class=k>mod</span> <span class=nn>tests</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=k>super</span>::<span class=o>*</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>actix_web</span>::<span class=p>{</span><span class=n>test</span><span class=p>,</span><span class=w> </span><span class=n>web</span><span class=p>,</span><span class=w> </span><span class=n>App</span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=cp>#[actix_rt::test]</span><span class=w>
</span><span class=w>    </span><span class=n>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>test_index_get</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>app</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>init_service</span><span class=p>(</span><span class=w>
</span><span class=w>            </span><span class=n>App</span>::<span class=n>new</span><span class=p>()</span><span class=w>
</span><span class=w>                </span><span class=p>.</span><span class=n>data</span><span class=p>(</span><span class=n>AppState</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>count</span>: <span class=mi>4</span><span class=w> </span><span class=p>})</span><span class=w>
</span><span class=w>                </span><span class=p>.</span><span class=n>route</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span><span class=w> </span><span class=n>web</span>::<span class=n>get</span><span class=p>().</span><span class=n>to</span><span class=p>(</span><span class=n>index</span><span class=p>)),</span><span class=w>
</span><span class=w>        </span><span class=p>).</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>TestRequest</span>::<span class=n>get</span><span class=p>().</span><span class=n>uri</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>).</span><span class=n>to_request</span><span class=p>();</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>resp</span>: <span class=nc>AppState</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>read_response_json</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>app</span><span class=p>,</span><span class=w> </span><span class=n>req</span><span class=p>).</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=n>assert_eq</span><span class=o>!</span><span class=p>(</span><span class=n>resp</span><span class=p>.</span><span class=n>count</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><h1 id=stream-response-tests>Stream response tests</h1><p>If you need to test stream generation, it would be enough to call <code>take_body()</code> and convert a
resulting <a href=https://docs.rs/actix-web/2/actix_web/body/enum.ResponseBody.html><em>ResponseBody</em></a> into a future and execute it, for example when testing
<a href=https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events><em>Server Sent Events</em></a>.</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>task</span>::<span class=n>Poll</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>bytes</span>::<span class=n>Bytes</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>futures</span>::<span class=n>stream</span>::<span class=n>poll_fn</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>actix_web</span>::<span class=n>http</span>::<span class=p>{</span><span class=n>ContentEncoding</span><span class=p>,</span><span class=w> </span><span class=n>StatusCode</span><span class=p>};</span><span class=w>
</span><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>actix_web</span>::<span class=p>{</span><span class=n>web</span><span class=p>,</span><span class=w> </span><span class=n>http</span><span class=p>,</span><span class=w> </span><span class=n>App</span><span class=p>,</span><span class=w> </span><span class=n>Error</span><span class=p>,</span><span class=w> </span><span class=n>HttpRequest</span><span class=p>,</span><span class=w> </span><span class=n>HttpResponse</span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=n>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>sse</span><span class=p>(</span><span class=n>_req</span>: <span class=nc>HttpRequest</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>HttpResponse</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>counter</span>: <span class=kt>usize</span> <span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=c1>// yields `data: N` where N in [5; 1]
</span><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>server_events</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>poll_fn</span><span class=p>(</span><span class=k>move</span><span class=w> </span><span class=o>|</span><span class=n>_cx</span><span class=o>|</span><span class=w> </span>-&gt; <span class=nc>Poll</span><span class=o>&lt;</span><span class=nb>Option</span><span class=o>&lt;</span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Bytes</span><span class=p>,</span><span class=w> </span><span class=n>Error</span><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>counter</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>Poll</span>::<span class=n>Ready</span><span class=p>(</span><span class=nb>None</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=p>}</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>payload</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>format</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;data: {}\n\n&#34;</span><span class=p>,</span><span class=w> </span><span class=n>counter</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=n>counter</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=n>Poll</span>::<span class=n>Ready</span><span class=p>(</span><span class=nb>Some</span><span class=p>(</span><span class=nb>Ok</span><span class=p>(</span><span class=n>Bytes</span>::<span class=n>from</span><span class=p>(</span><span class=n>payload</span><span class=p>))))</span><span class=w>
</span><span class=w>    </span><span class=p>});</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>HttpResponse</span>::<span class=n>build</span><span class=p>(</span><span class=n>StatusCode</span>::<span class=n>OK</span><span class=p>)</span><span class=w>
</span><span class=w>        </span><span class=p>.</span><span class=n>set_header</span><span class=p>(</span><span class=n>http</span>::<span class=n>header</span>::<span class=n>CONTENT_TYPE</span><span class=p>,</span><span class=w> </span><span class=s>&#34;text/event-stream&#34;</span><span class=p>)</span><span class=w>
</span><span class=w>        </span><span class=p>.</span><span class=n>set_header</span><span class=p>(</span><span class=w>
</span><span class=w>            </span><span class=n>http</span>::<span class=n>header</span>::<span class=n>CONTENT_ENCODING</span><span class=p>,</span><span class=w>
</span><span class=w>            </span><span class=n>ContentEncoding</span>::<span class=n>Identity</span><span class=p>.</span><span class=n>as_str</span><span class=p>(),</span><span class=w>
</span><span class=w>        </span><span class=p>)</span><span class=w>
</span><span class=w>        </span><span class=p>.</span><span class=n>streaming</span><span class=p>(</span><span class=n>server_events</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>App</span>::<span class=n>new</span><span class=p>().</span><span class=n>route</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span><span class=w> </span><span class=n>web</span>::<span class=n>get</span><span class=p>().</span><span class=n>to</span><span class=p>(</span><span class=n>sse</span><span class=p>));</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=cp>#[cfg(test)]</span><span class=w>
</span><span class=w></span><span class=k>mod</span> <span class=nn>tests</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=k>super</span>::<span class=o>*</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>actix_rt</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>futures_util</span>::<span class=n>stream</span>::<span class=n>StreamExt</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>futures_util</span>::<span class=n>stream</span>::<span class=n>TryStreamExt</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>actix_web</span>::<span class=p>{</span><span class=n>test</span><span class=p>,</span><span class=w> </span><span class=n>web</span><span class=p>,</span><span class=w> </span><span class=n>App</span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=cp>#[actix_rt::test]</span><span class=w>
</span><span class=w>    </span><span class=n>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>test_stream</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>app</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>init_service</span><span class=p>(</span><span class=n>App</span>::<span class=n>new</span><span class=p>().</span><span class=n>route</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span><span class=w> </span><span class=n>web</span>::<span class=n>get</span><span class=p>().</span><span class=n>to</span><span class=p>(</span><span class=n>sse</span><span class=p>))).</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>TestRequest</span>::<span class=n>get</span><span class=p>().</span><span class=n>to_request</span><span class=p>();</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>resp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>call_service</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>app</span><span class=p>,</span><span class=w> </span><span class=n>req</span><span class=p>).</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=n>assert</span><span class=o>!</span><span class=p>(</span><span class=n>resp</span><span class=p>.</span><span class=n>status</span><span class=p>().</span><span class=n>is_success</span><span class=p>());</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=c1>// first chunk
</span><span class=c1></span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=p>(</span><span class=n>bytes</span><span class=p>,</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>resp</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>resp</span><span class=p>.</span><span class=n>take_body</span><span class=p>().</span><span class=n>into_future</span><span class=p>().</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=n>assert_eq</span><span class=o>!</span><span class=p>(</span><span class=n>bytes</span><span class=p>.</span><span class=n>unwrap</span><span class=p>().</span><span class=n>unwrap</span><span class=p>(),</span><span class=w> </span><span class=n>Bytes</span>::<span class=n>from_static</span><span class=p>(</span><span class=s>b&#34;data: 5</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>));</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=c1>// second chunk
</span><span class=c1></span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=p>(</span><span class=n>bytes</span><span class=p>,</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>resp</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>resp</span><span class=p>.</span><span class=n>take_body</span><span class=p>().</span><span class=n>into_future</span><span class=p>().</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=n>assert_eq</span><span class=o>!</span><span class=p>(</span><span class=n>bytes</span><span class=p>.</span><span class=n>unwrap</span><span class=p>().</span><span class=n>unwrap</span><span class=p>(),</span><span class=w> </span><span class=n>Bytes</span>::<span class=n>from_static</span><span class=p>(</span><span class=s>b&#34;data: 4</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>));</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=c1>// remaining part
</span><span class=c1></span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span>::<span class=n>load_stream</span><span class=p>(</span><span class=n>resp</span><span class=p>.</span><span class=n>take_body</span><span class=p>().</span><span class=n>into_stream</span><span class=p>()).</span><span class=n>await</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=n>assert_eq</span><span class=o>!</span><span class=p>(</span><span class=n>bytes</span><span class=p>.</span><span class=n>unwrap</span><span class=p>(),</span><span class=w> </span><span class=n>Bytes</span>::<span class=n>from_static</span><span class=p>(</span><span class=s>b&#34;data: 3</span><span class=se>\n\n</span><span class=s>data: 2</span><span class=se>\n\n</span><span class=s>data: 1</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>));</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=github-edit><a class="fa fa-github" href=https://github.com/actix/actix-website/tree/master/content/docs/testing.md>Edit on GitHub</a></div><div class=actix-next><b>Next up</b>: <a href=/docs/middleware/>Middlewares</a></div></div></div></div></div><footer class=actix-footer><div class="text-muted actix-footer-gray d-flex justify-content-between"><div class=actix-footer-info>Copyright © 2020 The Actix Team</div><div class=actix-footer-social><a href=https://github.com/actix class=text-muted><i class="fa fa-github" aria-hidden=true></i></a></div></div></footer><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js integrity=sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7 crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js integrity=sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8 crossorigin=anonymous></script><script src=https://actix.rs/js/bootstrap.min.js></script><script src=https://actix.rs/js/actix.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-110322332-1','auto');ga('send','pageview');}</script></body></html>